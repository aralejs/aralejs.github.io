define("#calendar/0.8.0/calendar",["calendar","jquery","moment","overlay","templatable","./calendar.tpl","./model"],function(a,b,c){var d=a("jquery"),e=a("moment"),f=a("overlay"),g=a("templatable"),h=a("./calendar.tpl"),i=a("./model"),j={trigger:null,triggerType:"focus",format:"YYYY-MM-DD",align:{getter:function(){var a=this.get("trigger");return a?{selfXY:[0,0],baseElement:a,baseXY:[0,d(a).height()+10]}:{selfXY:[0,0],baseXY:[0,0]}}},hideOnSelect:!0,startDay:"Sun",showTime:!1,lang:null,focus:{value:"",getter:function(a){return e(a?a:undefined)}},range:null,template:h,model:{getter:function(){if(!this.hasOwnProperty("model")){var a={lang:this.get("lang"),focus:this.get("focus"),range:this.get("range"),showTime:this.get("showTime"),startDay:this.get("startDay")};this.model=new i(a)}return this.model}}},k=f.extend({Implements:[g],attrs:j,events:{"click [data-role=mode-year]":"_changeMode","click [data-role=prev-year]":"prevYear","click [data-role=next-year]":"nextYear","click [data-role=mode-month]":"_changeMode","click [data-role=prev-month]":"prevMonth","click [data-role=next-month]":"nextMonth","click [data-role=previous-10-year]":"_selectYear","click [data-role=next-10-year]":"_selectYear","click [data-role=year]":"_selectYear","click [data-role=month]":"_selectMonth","click [data-role=day]":"_selectDay","click [data-role=date]":"_selectDate","click [data-role=today]":"_selectToday",keydown:"_keyControl"},setup:function(){var a=this,b=this.get("trigger");d(b).on(this.get("triggerType"),function(){a.render().show()}),d(b).on("keydown",function(b){b.keyCode===38?(a.element.focus(),a.model.changeTime("days",-7)):b.keyCode===40&&(a.element.focus(),a.model.changeTime("days",7))});var c=this.model,e={"change:year change:month":"[data-role=month-year-container]","change:day":"[data-role=pannel-container]","change:date":"[data-role=data-container]","change:time":"[data-role=time-container]","change:mode":["[data-role=data-container]","[data-role=pannel-container]"]};d.each(e,function(b,e){c.on(b,function(){d.isArray(e)||(e=[e]),d.each(e,function(b,c){a.renderPartial(c)})})}),a.get("showTime")&&setInterval(function(){c.set("time")},1e3)},range:function(a){this.model.range=a,this.model.renderData()},prevYear:function(){return this.model.changeTime("years",-1),this},nextYear:function(){return this.model.changeTime("years",1),this},prevMonth:function(){return this.model.changeTime("months",-1),this},nextMonth:function(){return this.model.changeTime("months",1),this},_selectYear:function(a){var b=d(a.target);b.data("role")==="year"?this.model.changeMode("date",{year:b.data("value")}):this.model.changeMode("year",{year:b.data("value")})},_selectMonth:function(a){var b=d(a.target);this.model.changeMode("date",{month:b.data("value")})},_selectDay:function(a){var b=d(a.target);this.model.changeStartDay(b.data("value"))},_selectDate:function(a){var b=d(a.target),c=this.model.selectDate({year:b.data("year"),month:b.data("month"),date:b.data("date")});this._fillDate(c)},_selectToday:function(){var a=e();this.model.selectDate({year:a.year(),month:a.month(),date:a.date()})},_changeMode:function(a){var b=d(a.target).data("role").substring(5);this.model.changeMode(b)},_keyControl:function(a){var b={68:"date",77:"month",89:"year"};if(a.keyCode in b)return this.model.changeMode(b[a.keyCode]),!1;var c={13:"enter",27:"esc",37:"left",38:"up",39:"right",40:"down",72:"left",76:"right",74:"down",75:"up"};if(!(a.keyCode in c))return;var d=c[a.keyCode],e=this.model.get("mode");a.shiftKey&&d==="right"?this.nextYear():a.shiftKey&&d==="left"?this.prevYear():a.ctrlKey&&d==="right"?this.nextMonth():a.ctrlKey&&d==="left"?this.prevMonth():d==="esc"?this.hide():e.date?this._keyControlDate(d):e.month?this._keyControlMonth(d):e.year&&this._keyControlYear(d),a.preventDefault()},_keyControlDate:function(a){if(a==="enter"){var b=this.model.selectDate();this._fillDate(b);return}var c={right:1,left:-1,up:-7,down:7};this.model.changeTime("days",c[a])},_keyControlMonth:function(a){if(a==="enter"){var b=this.model.selectDate();this.model.changeMode("date",{month:b.month()});return}var c={right:1,left:-1,up:-3,down:3};this.model.changeTime("months",c[a])},_keyControlYear:function(a){if(a==="enter"){var b=this.model.selectDate();this.model.changeMode("date",{year:b.year()});return}var c={right:1,left:-1,up:-3,down:3};this.model.changeTime("years",c[a])},_fillDate:function(a){if(!this.model.isInRange(a))return this.trigger("select-disabled-date",a),this;this.trigger("select-date",a);var b=this.get("trigger");if(!b)return this;var c=d(b);if(typeof c[0].value=="undefined")return this;var e=a.format(this.get("format"));c.val(e);var f=this.get("hideOnSelect");f&&this.hide()}});k.autoRender=function(a){a.trigger=a.element,a.element="",new k(a)},c.exports=k});